# 雀魂牌谱数据统计工具

这是一个用于统计雀魂牌谱数据的Python脚本，可以分析用户在不同模式下的连续吃一、连续一二、连续吃三、连续吃四、连续非一、连续非四的最高次数。

## 功能特点

- 支持多模式分析（模式16,12,9,11,8）
- 自动获取用户的所有牌谱数据（无需设置页数限制）
- 统计各种连续记录
- 智能数据获取（自动遍历历史数据）
- 提供详细的统计报告
- 支持结果保存到JSON文件
- 合并所有模式的统计结果
- 显示排名历史数组（从当前时间往前）

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 直接运行脚本

```bash
python majsoul_analyzer.py
```

然后按提示输入用户ID和要分析的模式。

### 快速测试

```bash
python quick_test_multi_mode.py
```

### 作为模块使用

```python
from majsoul_analyzer import MajsoulAnalyzer

# 创建分析器实例（支持自定义模式）
analyzer = MajsoulAnalyzer(user_id=220352, modes=[16, 12, 9, 11, 8])

# 分析所有记录（自动获取所有历史数据）
analyzer.analyze_all_records()

# 打印统计结果
analyzer.print_statistics()

# 保存结果到文件
analyzer.save_to_file("my_stats.json")
```

## 统计指标说明

- **连续吃一**: 连续获得第1名的局数
- **连续一二**: 连续获得第1名或第2名的局数
- **连续吃三**: 连续获得第3名的局数
- **连续吃四**: 连续获得第4名的局数
- **连续非一**: 连续不是第1名的局数
- **连续非四**: 连续不是第4名的局数

## 支持的模式

- **模式16**: 王座
- **模式12**: 玉
- **模式9**: 金
- **模式11**: 玉东
- **模式8**: 金东

## 输出示例

```
================================================================================
用户 220352 的牌谱统计结果
================================================================================
分析模式: 16(王座), 12(玉), 9(金), 11(玉东), 8(金东)
总游戏局数: 1250

当前连续统计:
  连续吃一: 3 局
  连续一二: 8 局
  连续吃三: 0 局
  连续吃四: 0 局
  连续非一: 2 局
  连续非四: 15 局

历史最大连续记录:
  最大连续吃一: 12 局
  最大连续一二: 25 局
  最大连续吃三: 8 局
  最大连续吃四: 6 局
  最大连续非一: 15 局
  最大连续非四: 45 局
================================================================================

排名历史记录 (从当前时间往前):
================================================================================
最近排名记录:
   1. 2024-01-15 14:30:25 - 第1位 (王座)
   2. 2024-01-15 14:15:10 - 第2位 (玉)
   3. 2024-01-15 14:00:05 - 第1位 (金)
   ...

排名数组 (共1250局):
  [1, 2, 1, 3, 4, 2, 1, 1, 2, 3, ...]

排名分布:
  第1位: 375局 (30.0%)
  第2位: 312局 (25.0%)
  第3位: 290局 (23.2%)
  第4位: 273局 (21.8%)

各模式游戏数量:
  8(金东): 250局 (20.0%)
  9(金): 300局 (24.0%)
  11(玉东): 200局 (16.0%)
  12(玉): 350局 (28.0%)
  16(王座): 150局 (12.0%)
================================================================================
```

## 数据获取机制

脚本使用智能数据获取机制：
- 从当前时间开始，自动向前获取历史数据
- 使用时间戳递减的方式遍历所有历史记录
- 当API返回空数据时自动停止
- 无需手动设置页数限制，确保获取完整数据

## 注意事项

1. 脚本会自动处理API请求频率限制
2. 大量数据获取可能需要较长时间
3. 建议在网络稳定的环境下使用
4. 支持自动获取所有历史数据

## API说明

脚本使用雀魂官方API：
- 基础URL: `https://5-data.amae-koromo.com/api/v2/pl4/player_records`
- 请求格式: `/{user_id}/{start_time}/0`
- 数据格式: JSON
- 支持多模式查询（用逗号分隔）

## 错误处理

脚本包含完善的错误处理机制：
- 网络请求异常处理
- 数据解析错误处理
- 用户输入验证
- 进度显示和中断处理
- 自动重试机制
